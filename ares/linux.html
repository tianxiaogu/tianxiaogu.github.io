<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> Run Ares on Linux |  Tianxiao Gu</title>


    <!-- Styles -->
    <link href="/css/font-awesome.min.css" rel="stylesheet" type="text/css"><!-- font-awesome -->
    <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css"><!-- Bootstrap -->
    <link href="/css/pygments.css" rel="stylesheet" type="text/css"><!-- Pygments -->
    <link href="/css/moon.css" rel="stylesheet" type="text/css"><!-- Pygments -->
    <link href="/css/bibtex.css" rel="stylesheet" type="text/css"><!-- Pygments -->
  </head>
  <body role="document">
    <div class="container">
    <h1 id="run-ares-on-linux">Run Ares on Linux</h1>
<div class="toc">
<ul>
<li><a href="#run-ares-on-linux">Run Ares on Linux</a><ul>
<li><a href="#get-source">Get Source</a></li>
<li><a href="#build">Build</a><ul>
<li><a href="#ares-jpf">Ares-JPF</a></li>
<li><a href="#ares">Ares</a></li>
</ul>
</li>
<li><a href="#setup">Setup</a></li>
<li><a href="#run">Run</a><ul>
<li><a href="#unit-test">Unit Test</a></li>
<li><a href="#ase-2016">ASE 2016</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h2 id="get-source">Get Source</h2>
<p>Checkout the following projects.</p>
<ul>
<li><a href="https://bitbucket.org/txgu/ares">ares</a></li>
<li><a href="https://bitbucket.org/txgu/ares-jpf">ares-jpf</a></li>
</ul>
<p>You should download a <code>jdk1.8.0_65</code> from oracle to build Ares.</p>
<h2 id="build">Build</h2>
<h3 id="ares-jpf">Ares-JPF</h3>
<ol>
<li>Just use <a href="http://ant.apache.org">ant</a></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>ares-jpf</code> depends on an old version of JPF.
I have to build a local <code>jpf-core</code> in <code>ares-jpf</code> since
<a href="http://babelfish.arc.nasa.gov/hg/jpf/jpf-core/">JPF</a> has reset its source history.</p>
</div>
<h3 id="ares">Ares</h3>
<ol>
<li>Install <code>redis</code> and <code>libhiredis-dev</code><ul>
<li>For a feature under development.</li>
</ul>
</li>
<li>
<p>Check <code>make\quick_build.sh</code></p>
<ul>
<li>In default, this script will build all configurations.
  Usually I only build two configurations, i.e., <code>product</code> and <code>fastdebug</code>.
  You can specify a configuration.<pre class="codehilite"><code class="linenums">quick_build.sh fastdebug</code></pre>


</li>
</ul>
</li>
<li>
<p>If everything is OK, you will find a script <code>hotspot</code> at <code>build/linux/linux_amd64_compiler2/fastdebug/hotspot</code>
   Run this script as a replacement of the command <code>java</code>.</p>
<pre class="codehilite"><code class="linenums">hotspot HelloWorld</code></pre>


</li>
</ol>
<h2 id="setup">Setup</h2>
<p>Ares can be used as a drop-in replacement of <code>java</code>
and it provides many extra options.</p>
<ul>
<li>Checkout the options declared in <a href="https://bitbucket.org/txgu/ares/src/master/src/share/vm/runtime/globals.hpp?at=master&amp;fileviewer=file-view-default#globals.hpp-3948">globals.hpp</a></li>
</ul>
<p>The following is what I have set during my evaluation.</p>
<pre class="codehilite"><code class="language-bash linenums">ARES_LOG=&quot;-XX:TraceRuntimeRecovery=2048&quot;
# JVM has two JIT compilers, c1 (compiler1) and c2 (compiler2).
# We only implemented Ares on c2.
# So, disable c1 here.
ARES_VM=&quot;-XX:-TieredCompilation&quot;

export ARES_HOME=/code/ares/hotspot/
export ARES_JPF_HOME=/code/ares/ares-jpf
export ARES_BIN=${ARES_HOME}/build/linux/linux_amd64_compiler2/fastdebug/hotspot


# JPF Options
ARES_JPF=&quot;${ARES_JPF_HOME}/ares-jpf.jar:${ARES_JPF_HOME}/lib/jpf-classes.jar:${ARES_JPF_HOME}/lib/jpf.jar&quot;

# Use JPF
export JPF=&quot;$ARES_VM $ARES_LOG -XX:+UseJPF -Xbootclasspath/a:${ARES_JPF}&quot;

# Use 1-ER
export FER=&quot;$ARES_VM $ARES_LOG -XX:-UseErrorTransformation -XX:+UseEarlyReturn -XX:-OnlyEarlyReturnVoid&quot;

# Use VOER
export VOER=&quot;$ARES_VM $ARES_LOG -XX:-UseErrorTransformation -XX:+UseEarlyReturn -XX:+OnlyEarlyReturnVoid&quot;

# Use SBET
export SBET=&quot;$ARES_VM $ARES_LOG -XX:+UseErrorTransformation -XX:-UseEarlyReturn -XX:+UseStack -XX:-UseForceThrowable&quot;

# Use FTET
export FTET=&quot;$ARES_VM $ARES_LOG -XX:+UseErrorTransformation -XX:-UseEarlyReturn -XX:-UseStack -XX:+UseForceThrowable&quot;</code></pre>


<p>During my evaluation, I always created a script named <code>run.sh</code>.
So, I made the following aliases.
Therefore, <code>$RUN_FER</code> will be expand to <code>JAVA=$ARES_BIN VM_OPTS=$FER ./run.sh &gt; fer.txt</code>.</p>
<pre class="codehilite"><code class="language-bash linenums">export RUN_FER=&quot;JAVA=\&quot;$ARES_BIN\&quot;  VM_OPTS=\&quot;$FER\&quot; ./run.sh &gt; fer.txt&quot;
export RUN_VOER=&quot;JAVA=\&quot;$ARES_BIN\&quot; VM_OPTS=\&quot;$VOER\&quot; ./run.sh &gt; voer.txt&quot;
export RUN_SBET=&quot;JAVA=\&quot;$ARES_BIN\&quot; VM_OPTS=\&quot;$SBET\&quot; ./run.sh &gt; sbet.txt&quot;
export RUN_FTET=&quot;JAVA=\&quot;$ARES_BIN\&quot; VM_OPTS=\&quot;$FTET\&quot; ./run.sh &gt; ftet.txt&quot;
export RUN_JPF=&quot;JAVA=\&quot;$ARES_BIN\&quot; VM_OPTS=\&quot;$JPF\&quot; ./run.sh &gt; jpf.txt&quot;</code></pre>


<h2 id="run">Run</h2>
<h3 id="unit-test">Unit Test</h3>
<p>Let's begin with a program that throws a <code>RuntimeException</code>.</p>
<pre class="codehilite"><code class="language-java linenums">import java.io.*;
public class ThrowRuntimeException{

    public static void do_throw_RuntimeException(){
        throw new RuntimeException();
    }

    public static void throw_IOException_wrapper() throws IOException{
        do_throw_RuntimeException();
        FileInputStream fis = new FileInputStream(&quot;hello.txt&quot;);

    }

    public static void do_throw_IOException(){
        try{
            throw_IOException_wrapper();
        }catch(IOException e){
            System.out.println(&quot;Catch an IOException &quot; + e.toString());
        }
    }

    public static void do_catch_Exception(){
        try{
            do_throw_IOException();
        }catch(Exception e){
            System.out.println(&quot;Catch a/an &quot; + e);
        }
    }

    public static void main(String []args){
        do_catch_Exception();
    }

}</code></pre>


<ol>
<li>
<p>Build it</p>
<p><code>javac ThrowRuntimeException.java</code></p>
</li>
<li>
<p>Run it with <code>java</code></p>
<p><code>java ThrowRuntimeException</code></p>
</li>
<li>
<p>Run it with Ares</p>
<p><code>$ARES_BIN $FER ThrowRuntimeException</code></p>
</li>
</ol>
<p>Checkout the output and try to understand Ares how to mitigate an unchecked exception.</p>
<h3 id="ase-2016">ASE 2016</h3>
<p>Subjects are hosted in <a href="https://git.njuics.cn/ares">git.njuics.cn</a>.</p>
<p>Every bug should have a <code>run.sh</code>.
Otherwise, send an email to me.</p>
<ul>
<li><a href="https://git.njuics.cn/ares/ares-tomcat">Tomcat</a></li>
<li><a href="https://git.njuics.cn/ares/ares-jetty">Jetty</a></li>
<li><a href="https://git.njuics.cn/ares/ares-ganttproject">GanttProject</a></li>
<li><a href="https://git.njuics.cn/ares/ares-jmeter">JMeter</a></li>
<li>If you cannot access this web site <a href="https://git.njuics.cn">git.njuics.cn</a>, send an email to me.</li>
</ul>
<div class="admonition warnning">
<p class="admonition-title">Warnning</p>
<p>Ares is only a prototype.
If you encounter any crash,
disable the JIT compiler by adding a VM option <code>-Xint</code> and then make a retry.</p>
</div>
    </div>

    <footer class="footer">
      <div class="container">
        <span class="text-muted">&copy; 2017 Tianxiao Gu. All rights reserved.</span>
      </div>
    </footer>

    <!-- jQuery -->
    <script src="/js/jquery-3.2.1.min.js"></script>
    <script src="/js/jquery-migrate-1.4.1.min.js"></script>
    <!-- Bootstrap -->
    <script src="/js/bootstrap.min.js"></script>

    
  </body>
</html>