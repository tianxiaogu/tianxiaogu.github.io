<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> SATA |  Tianxiao Gu</title>


    <!-- Styles -->
    <link href="/css/font-awesome.min.css" rel="stylesheet" type="text/css"><!-- font-awesome -->
    <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css"><!-- Bootstrap -->
    <link href="/css/pygments.css" rel="stylesheet" type="text/css"><!-- Pygments -->
    <link href="/css/moon.css" rel="stylesheet" type="text/css"><!-- moon -->
    <link href="/css/bibtex.css" rel="stylesheet" type="text/css"><!-- bibtex-->
  </head>
  <body role="document">
    <div class="container">
    <h1 id="sata-steering-automated-testing-for-android-applications">SATA: Steering Automated Testing for Android Applications</h1>
<p>A replacement of Monkey.</p>
<p>Download our model-based automated testing tool <a href="ape-bin.zip">Ape</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ape is the internal name used during developing SATA.</p>
</div>
<p>Files inside <code>ape-bin.zip</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>ape-bin/
ape-bin/7/
ape-bin/7/ape.jar  &lt;--- For Android 7
ape-bin/ape.jar    &lt;--- For Android 6
ape-bin/ape.py
ape-bin/README.md
</pre></div>
</td></tr></table>

<h2 id="install">Install</h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>adb push ape.jar /sdcard/
</pre></div>
</td></tr></table>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For Android 7, just use another jar.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>adb puosh 7/ape.jar /sdcard/
</pre></div>
</td></tr></table>

</div>
<h2 id="run">Run</h2>
<p>We provide a python script (i.e., <code>ape.py</code>) to facilitate running ape on Android platform.</p>
<p>The following command starts to run SATA to test the Calculator on a real device connected via <code>adb</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>./ape.py -p com.google.android.calculator --running-minutes 100 --ape sata
</pre></div>
</td></tr></table>

<p>Check the <code>ape.py</code> if you want to run SATA with an emulator.
You should at least remove the <code>-d</code> options for <code>adb</code>.</p>
<p>Options:</p>
<ul>
<li><code>-p</code>: specify the package name, the same as Monkey</li>
<li><code>--running-minutes</code>: the total testing time in minutes<ul>
<li>This is the continuous mode, which means SATA does not stop when it triggers a crash.</li>
</ul>
</li>
<li><code>--ape sata</code>: use the SATA exploration strategy described in the paper.<ul>
<li>You can also try <code>orbit</code>, <code>wechat</code>, <code>random</code>, and reinforcement learning enhanced random (<code>satarl</code>)</li>
</ul>
</li>
</ul>
<p>You can also specify the total amount of Monkey events. In this mode, SATA will stop by default once there is a crash.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>./ape.py -p com.google.android.calculator --ape sata 1000
</pre></div>
</td></tr></table>

<h2 id="visualization">Visualization</h2>
<p>We provide a tool to visualize the model.</p>
<ol>
<li>SATA writes several js files into the output folder for visualization.<ul>
<li>Check the tail of the output message to locate the output folder in the phone.</li>
</ul>
</li>
<li><code>adb pull /sdcard/your-output-folder</code> to your local directory.</li>
<li>Copy the following files into the local output directory<ul>
<li><a href="./demo/vis.html">vis.html</a> (Right click and choose 'save as')</li>
<li><a href="./demo/vis.min.css">vis.min.css</a></li>
<li><a href="./demo/vis.min.js">vis.min.js</a></li>
</ul>
</li>
<li>Open the copied <code>vis.html</code> in your browser.<ul>
<li>You may need to wait for a certain amount of time to let the browser render the model.</li>
</ul>
</li>
</ol>
<p>Examples:</p>
<ul>
<li><a href="./demo/vis.html">Calculator</a></li>
<li><a href="./demo-mtxx/vis.html">Meitu</a> (1 min).</li>
</ul>
<p>Now we can check the timeline.</p>
<ul>
<li><a href="./demo-keep-timeline/vis.html">Google Keep</a><ul>
<li><a href="./demo-keep-timeline/vis-timeline.html">Timeline</a></li>
</ul>
</li>
</ul>
<h2 id="configuration">Configuration</h2>
<p>SATA is under developing now. There is no stable documentation right now.</p>
<p>Put the following content into <code>/sdcard/ape.properties</code> to configure SATA.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>ape.WebViewActionThreshold = 30
ape.activityStableRestartThreshold = 200
ape.alwaysIgnoreWebViewAction = true
ape.avoidEditText = false
ape.checkHomogeneous = false
ape.checkUnsaturatedTrivialState = true
ape.defaultAlpha = 0.2
ape.defaultBeta = 0.8
ape.defaultEpsilon = 0.05
ape.defaultGUIThrottle = 200
ape.defaultGamma = 0.8
ape.defaultMaxDepthEarlyStage = 3
ape.defaultMaxLengthEarlyStage = 2
ape.extraBasePriority = 3
ape.fallbackToGraphTransition = true
ape.fillTransitionsByHistory = true
ape.flushImagesThreshold = 10
ape.generateRandomTextInput = true
ape.graphStableRestartThreshold = 100
ape.ignoreEmpty = true
ape.ignoreEmptyWebViewWidget = true
ape.ignoreEmptyWidget = false
ape.ignoreOutOfBounds = true
ape.ignoreOutOfBoundsWidget = true
ape.imageWriterCount = 3
ape.includeFocusable = true
ape.invalidBackCircleThreshold = 3
ape.maxAppendThrottle = 3000
ape.nopActionThrottle = 1000
ape.onlyAddedActions = true
ape.randomPickFromStringList = false
ape.simpleGreedyEarlyStage = false
ape.sizeOfGuiTreeBuffer = 5
ape.startActionThrottle = 0
ape.stateStableCheckWelcomeThreshold = 10
ape.stateStableRestartThreshold = 50
ape.stopWhenEqual = true
ape.takeScreenshot = true
ape.takeScreenshotForEveryStep = true
ape.takeScreenshotForNewState = true
ape.throttleForUnvisitedAction = 500
ape.throttlePerActivityTransition = 100
ape.throttlePerTrivialState = 1000
ape.throttlePerWeakEdge = 500
ape.trivialStateActionThreshold = 1
ape.trivialStateUnsaturationActionThreshold = 3
ape.trivialStateUnsaturationThreshold = 3
ape.trivialStateWidgetThreshold = 3
ape.useComplexSPathChildrenThreshold = 5
ape.useComplexSPathDescendantActionThreshold = 20
ape.useDynamicSPath = true
ape.useShortID = false
ape.useShortestPathForEarlyStage = false
ape.useSimpleSPath = false
ape.useSingleScroll = false
</pre></div>
</td></tr></table>

<h2 id="trap-detection">Trap Detection</h2>
<p>SATA will force the app to be restarted if it detects that it stays in a particular activity/state for a certain number of steps.
In addition, SATA will also restart the app if the graph is not updated for a specific steps.</p>
<p>Check the following options.</p>
<ol>
<li><code>ape.graphStableRestartThreshold</code></li>
<li><code>ape.stateStableRestartThreshold</code></li>
<li><code>ape.activityStableRestartThreshold</code></li>
</ol>
<h2 id="webview">WebView</h2>
<p>The <code>uiautomator dump</code> now support dumping contents into WebView.
But SATA ignores widgets inside a WebView by default.</p>
<p>Check the following options.</p>
<ol>
<li><code>ape.alwaysIgnoreWebViewAction = true</code><ul>
<li>This option will make SATA ignore any WebView.</li>
</ul>
</li>
<li><code>ape.WebViewActionThreshold = 30</code><ul>
<li>This option will make SATA to ignore any WebView that has more than 30 interactive widgets.</li>
</ul>
</li>
</ol>
<h2 id="xpathlet">XPathlet</h2>
<p>SATA now supports configuring widgets-specified behaviors via XPath.</p>
<p>Put the following json into the file <code>/sdcard/ape.xpath</code>.
This will disable actions on any widget that has no text.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>[{
    &quot;xpath&quot;: &quot;//*[@text=&#39;&#39;]&quot;,
    &quot;actions&quot;: []
}]
</pre></div>
</td></tr></table>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use <a href="https://jsonlint.com/">https://jsonlint.com/</a> to validate your json first.</p>
</div>
<p>The field <code>actions</code> is an array of action names.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>NOP
CLICK
LONG_CLICK
SCROLL_TOP_DOWN
SCROLL_BOTTOM_UP
SCROLL_LEFT_RIGHT
SCROLL_RIGHT_LEFT
</pre></div>
</td></tr></table>

<h2 id="screenshots">Screenshots</h2>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>ape.takeScreenshot = true
ape.takeScreenshotForEveryStep = true
ape.takeScreenshotForNewState = true
ape.imageWriterCount = 3
</pre></div>
</td></tr></table>

<h2 id="misc">Misc.</h2>
<h3 id="input-chinese">Input Chinese</h3>
<p>SATA can input Unicode text using the ADB Keyboard.</p>
<p><a href="https://github.com/senzhk/ADBKeyBoard">https://github.com/senzhk/ADBKeyBoard</a></p>
    </div>

    <footer class="footer" style="margin-top:10px;">
      <div class="container">
          <span class="text-muted">&copy; 2017 <a href="/">Tianxiao Gu</a>. All rights reserved.</span>
      <div style="width:70px;height:48px;">
      <script type='text/javascript' id='clustrmaps' src='//cdn.clustrmaps.com/map_v2.js?cl=ffffff&w=70&t=n&d=I1T5oEaSW-FJIJ_bZCvK8XMDQ35ouGHQP_ixsLYwvOo'></script></div>
      </div>
    </footer>

    <!-- jQuery -->
    <script src="/js/jquery-3.2.1.min.js"></script>
    <script src="/js/jquery-migrate-1.4.1.min.js"></script>
    <!-- Bootstrap -->
    <script src="/js/bootstrap.min.js"></script>

    
  </body>
</html>